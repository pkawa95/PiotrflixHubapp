<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>PiotrFlix – Menu</title>

  <!-- Montserrat (Twoja prośba o font) -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">

  <style>
    /* ===== Zmienne – korzystamy z Twoich, ale dajemy też bezpieczne fallbacki ===== */
    :root{
      --nav-bg-dark: var(--nav-bg-dark, rgba(16,18,28,.92));
      --nav-bg-light: var(--nav-bg-light, rgba(255,255,255,.94));
      --accent: var(--accent, #c600ff);
      --accent-2: var(--accent-2, #00f0ff);
      --color-dark: var(--color-dark, #eef2ff);
      --color-light: var(--color-light, #0a0a0f);
      --separator-dark: rgba(255,255,255,.12);
      --separator-light: rgba(0,0,0,.10);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --nav-height: 64px;
    }

    /* ===== Dock na dole – prosty, kwadratowy, z separatorami ===== */
    #nav{
      position: fixed; left: 0; right: 0; bottom: 0;
      display: grid; grid-template-columns: repeat(4,1fr);
      padding: 0 calc(8px) calc(8px + var(--safe-bottom));
      background: var(--nav-bg-dark);
      border-top: 1px solid rgba(255,255,255,.15);
      box-shadow: 0 -6px 14px rgba(0,0,0,.40);
      backdrop-filter: blur(12px) saturate(130%);
      -webkit-backdrop-filter: blur(12px) saturate(130%);
      z-index: 999;
      font-family: "Montserrat", system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      height: auto;
    }
    body[data-theme="light"] #nav{
      background: var(--nav-bg-light);
      border-top: 1px solid var(--separator-light);
      box-shadow: 0 -6px 12px rgba(0,0,0,.12);
    }

    /* przyciski – „kwadratowe”, ostre; separator między segmentami */
    .nav-btn{
      appearance: none; border: 0; margin: 0;
      background: transparent; color: inherit;
      display: grid; place-items: center;
      grid-template-rows: 26px auto;
      padding: .75rem .25rem .7rem;
      cursor: pointer; user-select: none;
      transition: background .2s ease, color .2s ease, transform .12s ease;
      font-weight: 700; font-size: .9rem; line-height: 1;
      border-radius: 0; /* kwadratowe */
      position: relative;
    }
    .nav-btn:not(:last-child){
      border-right: 1px solid var(--separator-dark);
    }
    body[data-theme="light"] .nav-btn:not(:last-child){
      border-right: 1px solid var(--separator-light);
    }

    /* białe ikony SVG – sterowane currentColor */
    .nav-ico{
      width: 22px; height: 22px;
      display: inline-block;
      color: #fff; /* domyślnie białe */
      transition: transform .18s ease, opacity .18s ease;
    }
    body[data-theme="light"] .nav-ico{ color: #000; } /* w jasnym – dopasuj do tekstu, później nadpisujemy kolorem aktywnym */

    .nav-label{
      margin-top: .28rem;
      font-size: .78rem;
      letter-spacing: .2px;
    }

    /* hover/active */
    @media (hover:hover){
      .nav-btn:hover .nav-ico{ transform: translateY(-2px); opacity: 1; }
      .nav-btn:hover{ color: var(--accent-2); }
    }
    .nav-btn:active{ transform: translateY(1px); }

    /* aktywny – cienka linia + kolor akcentu */
    .nav-btn[aria-selected="true"],
    .nav-btn.active{
      color: var(--accent);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    }
    .nav-btn[aria-selected="true"]::after,
    .nav-btn.active::after{
      content:"";
      position:absolute; left:0; right:0; bottom:0; height:3px;
      background: var(--accent);
      transform-origin: left center; transform: scaleX(1);
      animation: underlineIn .25s ease;
    }
    @keyframes underlineIn{ from{ transform:scaleX(0) } to{ transform:scaleX(1) } }

    /* responsywność – ciaśniej na małych */
    @media (max-width:600px){
      .nav-btn{ grid-template-rows: 24px auto; padding:.6rem .15rem .55rem; }
      .nav-label{ font-size: .74rem; }
    }

    /* aby sekcje nad navem nie „wchodziły” pod spód – jeśli menu jest wklejone do index.html */
    body{ padding-bottom: calc(var(--nav-height) + 16px + var(--safe-bottom)); }
    @media (max-width:600px){ :root{ --nav-height:72px; } }
  </style>
</head>
<body>

  <!-- ===== NAWIGACJA ===== -->
  <nav id="nav" role="tablist" aria-label="Główna nawigacja">
    <button class="nav-btn" data-section="torrents" role="tab" aria-controls="section-torrents" aria-selected="false">
      <svg class="nav-ico" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <!-- secure-download -->
        <path d="M12 3a4 4 0 0 0-4 4v2H6a1 1 0 0 0-1 1v1h14V10a1 1 0 0 0-1-1h-2V7a4 4 0 0 0-4-4Zm-1 11.59V9h2v5.59l1.29-1.3 1.42 1.42-3.7 3.7a1 1 0 0 1-1.42 0l-3.7-3.7 1.42-1.42L11 14.59ZM5 20a2 2 0 0 1-2-2v-4h2v4h14v-4h2v4a2 2 0 0 1-2 2H5z"/>
      </svg>
      <span class="nav-label">Torrenty</span>
    </button>

    <button class="nav-btn" data-section="search" role="tab" aria-controls="section-search" aria-selected="false">
      <svg class="nav-ico" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <!-- search -->
        <path d="M10 4a6 6 0 1 1 0 12A6 6 0 0 1 10 4m0-2a8 8 0 1 0 5.29 14.02l4.84 4.85 1.41-1.42-4.83-4.84A8 8 0 0 0 10 2z"/>
      </svg>
      <span class="nav-label">Szukaj</span>
    </button>

    <button class="nav-btn" data-section="browse" role="tab" aria-controls="section-browse" aria-selected="false">
      <svg class="nav-ico" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <!-- folder-search -->
        <path d="M10 4l2 2h6a2 2 0 0 1 2 2v2H4V6a2 2 0 0 1 2-2h4zm-6 8h20v6a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2v-6zm9 1.5a3.5 3.5 0 1 0 2.45 6l1.78 1.77 1.06-1.06-1.77-1.78A3.5 3.5 0 0 0 13 13.5zm0 2a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3z"/>
      </svg>
      <span class="nav-label">Przeglądaj</span>
    </button>

    <button class="nav-btn" data-section="available" role="tab" aria-controls="section-available" aria-selected="false">
      <svg class="nav-ico" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
        <!-- film -->
        <path d="M4 4h3v3H4V4Zm0 6h3v3H4v-3Zm0 6h3v3H4v-3ZM9 4h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H9V4Zm-5 0a2 2 0 0 0-2 2v12c0 1.1.9 2 2 2h1v-2H4V6h1V4H4Zm11 0v3h3V4h-3Zm0 6v3h3v-3h-3Zm0 6v3h3v-3h-3Z"/>
      </svg>
      <span class="nav-label">Dostępne</span>
    </button>
  </nav>

  <script>
    (function(){
      const NAV_SELECTOR = '#nav';
      const SECTION_PREFIX = 'section-';
      const STORAGE_KEY = 'pf:lastSection';

      const nav = document.querySelector(NAV_SELECTOR);
      const buttons = Array.from(nav.querySelectorAll('.nav-btn'));

      function getSections(){
        // sekcje są w głównym index.html
        return Array.from(document.querySelectorAll('.section'));
      }

      function activate(sectionKey, pushState = true){
        // 1) podświetl nav
        buttons.forEach(b=>{
          const active = b.dataset.section === sectionKey;
          b.classList.toggle('active', active);
          b.setAttribute('aria-selected', active ? 'true' : 'false');
          b.setAttribute('tabindex', active ? '0' : '-1');
        });

        // 2) pokaż/ukryj sekcje
        const sections = getSections();
        sections.forEach(sec=>{
          const id = sec.id || '';
          const key = id.replace(SECTION_PREFIX,'');
          sec.classList.toggle('active', key === sectionKey);
          sec.hidden = key !== sectionKey;
        });

        // 3) zapisz i wyemituj zdarzenie dla ewentualnych innych skryptów
        try{ localStorage.setItem(STORAGE_KEY, sectionKey); }catch(_){}
        document.dispatchEvent(new CustomEvent('pf:navigate', { detail:{ section: sectionKey }}));

        // 4) focus
        const currentBtn = buttons.find(b=>b.dataset.section===sectionKey);
        if(currentBtn) currentBtn.focus({preventScroll:true});
      }

      // Kliknięcia
      nav.addEventListener('click', (e)=>{
        const btn = e.target.closest('.nav-btn');
        if(!btn) return;
        e.preventDefault();
        activate(btn.dataset.section);
      });

      // Klawiatura: strzałki lewo/prawo, Home/End, Enter/Space
      nav.addEventListener('keydown', (e)=>{
        const idx = buttons.findIndex(b=>b.getAttribute('aria-selected')==='true');
        if(e.key === 'ArrowRight'){
          const next = (idx + 1) % buttons.length;
          buttons[next].focus();
          e.preventDefault();
        }else if(e.key === 'ArrowLeft'){
          const prev = (idx - 1 + buttons.length) % buttons.length;
          buttons[prev].focus();
          e.preventDefault();
        }else if(e.key === 'Home'){
          buttons[0].focus(); e.preventDefault();
        }else if(e.key === 'End'){
          buttons[buttons.length-1].focus(); e.preventDefault();
        }else if(e.key === 'Enter' || e.key === ' '){
          const btn = document.activeElement.closest('.nav-btn');
          if(btn){ activate(btn.dataset.section); e.preventDefault(); }
        }
      });

      // Publiczna funkcja (nie koliduje, nadpisujemy tylko jeśli nie istnieje)
      if(typeof window.showSection !== 'function'){
        window.showSection = function(sectionKey){ activate(sectionKey); };
      }

      // Inicjalizacja: z localStorage albo „torrents”
      let start = 'torrents';
      try{
        const last = localStorage.getItem(STORAGE_KEY);
        if(last) start = last;
      }catch(_){}
      // Jeśli hash #browse itp. – weź z URL
      if(location.hash && /^#(torrents|search|browse|available)$/.test(location.hash)){
        start = location.hash.slice(1);
      }
      // Ustaw ARIA
      buttons.forEach((b,i)=>{
        b.setAttribute('tabindex', i===0 ? '0' : '-1');
      });
      // Aktywuj
      activate(start, false);

      // Aktualizuj hash (opcjonalnie)
      document.addEventListener('pf:navigate', (e)=>{
        const key = e.detail?.section;
        if(!key) return;
        history.replaceState(null, '', '#'+key);
      });
    })();
  </script>
</body>
</html>
